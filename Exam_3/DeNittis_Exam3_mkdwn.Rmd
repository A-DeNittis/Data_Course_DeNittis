---
title: "DeNittis_Exam3_Code"
author: "Alyson DeNittis"
date: "April 5, 2018"
---


### Part 1 (50 points): You have two fastq files in the Exam3 directory.

Load libraries

```{r Libraries, eval=FALSE}
library(ShortRead)
library(tidyr)
library(stringr)
library(msa)
library(seqinr)
library(dada2)
library(vegan)
library(ggplot2)
```

1. Convert these fastq reads to fasta reads. These new fasta reads should be named "Sample1.fasta" and "Sample2.fasta"

BASH CODE:
```{r eval=FALSE, include=TRUE}
alias fqtofa='sed -n '\''1~4s/^@/>/p;2~4p'\''''' 
for fn in *.fastq; do fqtofa $fn > $fn.fasta;done
```

2. How many DNA reads were detected in each sample?

Sample1.fastq.fasta:6577
Sample2.fastq.fasta:7731

BASH CODE:
```{r eval=FALSE, include=TRUE}
grep -c "^>" *.fasta
```

3. Trim the original fastq files so that only the first 100 bases are included from each DNA read within.
4. Save these trimmed fastq files as "Sample1.fastq.trim" and "Sample2.fastq.trim"

```{r eval=FALSE, include=TRUE}
fq.files = dir(path = getwd(), full.names = TRUE, pattern = ".fastq")
trim.files = dir(path = getwd(), full.names = FALSE, pattern = ".fastq")
dir.create(file.path(getwd(), "trimmed"))

for(i in filt.files){
  fastqFilter(fn = i,fout = paste0(getwd(),"/trimmed/",i,".trim"),
              truncLen = 100)
}
```

### Part 2 (50 points): There are two csv files in the Exam3 directory.
+ The file "exam3_otu_table.csv" is a "species" abundance table like we've seen before. It has the number of times a given DNA sequence was found in a given sample.
+ The file "exam3_metadata.csv" has information about the samples in the species abundance table.

I'm curious about whether the bacterial communities found in Soil are statistically different from those found in the Rhizosphere, **and** whether "Location" makes a difference (*i.e.*, is interactive).
I'm **not** interested in whether the host plant Species or Season are important

1. Import these files into R objects

```{r eval=FALSE, include=TRUE}
meta = read.csv("exam3_metadata.csv")
otu = read.delim("exam3_otu_table.csv)
```

2. Subset both objects to include only samples where SampleType is either "Soil" or "rhizosphere"

```{r eval=FALSE, warning=FALSE, include=TRUE}
meta = read.csv("exam3_metadata.csv", row.names = 1)
otu = read.csv("exam3_otu_table.csv", row.names = 1)
otunames = sub("_","",row.names(otu))
rownames(otu) = otunames
metanames = sub("_","",row.names(meta))
colnames(meta) = metanames

sampt = subset(meta, meta$SampleType == "Soil" | meta$SampleType == "rhizosphere")
t_otu = as.data.frame(t(otu))
subotu = as.data.frame(t_otu[which(row.names(t_otu) %in% row.names(sampt)),])
```

3. Perform a PermANOVA to determine whether there are significant differences in bacterial community composistion between these two sample types
I kept getting a warning about 'x' not being numeric and could not figure out how to fix. Here is the code that would have been used.

```{r eval=FALSE, include = TRUE}
adonis(subotu ~ sampt$SampleType)
```

4. Determine which bacterial *genus* is the **most abundant** for each of those sample types as a whole
Note: Genus is denoted by "g__" in the "Consensus.lineage" column of the species abundance table


